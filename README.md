# 🍱 企业内部 H5 报餐系统 (Enterprise Meal Booking System)

> **极简、高效、移动端优先的企业食堂报餐管理解决方案。**
> 基于原生 PHP + SQLite 开发，无需安装 MySQL，无需复杂的服务器配置，上传即用。

---

## 📖 项目简介

本系统专为中小企业、团队或学校食堂设计。解决了传统食堂管理中“报餐人数统计难”、“饭票/现金管理混乱”、“备菜数量预估不准”等痛点。员工通过手机 H5 页面即可自助报餐、退餐，管理员和财务人员在手机端即可完成审核、充值和统计工作。

### ✨ 核心特性
* **零依赖部署**：不需要 MySQL 数据库，不需要 Redis，只需要 PHP 环境即可运行。
* **移动端适配**：采用响应式设计，完美适配手机浏览器和微信内置浏览器。
* **角色权限分级**：支持 普通用户、财务人员、超级管理员 三级权限体系。
* **资金安全**：所有扣费、充值均采用数据库事务处理，杜绝账目不平。
* **灵活配置**：支持自定义身份（如内部员工/访客）、不同身份不同价格、自定义截单时间。

---

## 🚀 快速安装与部署

### 1. 环境要求
* **操作系统**：Linux (CentOS/Ubuntu) 或 Windows (WAMP/XAMPP/IIS)
* **Web 服务器**：Nginx 或 Apache
* **PHP 版本**：PHP 7.4 或更高版本
* **必要扩展**：`pdo_sqlite` (必须开启), `json`, `mbstring`, `session`

### 2. 部署步骤
1.  **上传代码**：将项目所有文件上传至服务器网站根目录。
2.  **设置权限 (Linux)**：
    * 确保 `/data` 目录及内部文件具有 **读写权限 (777)**，否则会提示 `database is locked` 或无法保存数据。
    * 命令参考：`chmod -R 777 /www/wwwroot/your_site/data`
3.  **配置运行目录**：
    * 为了安全，建议将 Web 服务器的运行目录（Document Root）指向 `/public` 文件夹。
    * 如果无法修改运行目录，请确保通过 `.htaccess` 或 Nginx 规则禁止外部访问 `/data` 和 `/core` 目录。
4.  **初始化安装**：
    * 在浏览器访问：`http://你的域名/install.php`
    * 看到“数据库结构已更新”提示后，系统即安装成功。
    * **⚠️ 警告**：安装完成后，请务必**手动删除** `public/install.php` 文件，防止数据被重置。

### 3. 首次登录
* **默认管理账号**：`13800138000`
* **默认密码**：`admin123`

---

## 📚 使用手册 (用户篇)

### 1. 注册与登录
* 访问首页，点击“注册新账号”。
* 填写真实姓名和手机号，选择对应的身份类型（如内部员工）。
* 注册后状态为“待审核”，请联系管理员通过审核后方可登录。

### 2. 在线报餐
* 登录后点击底部导航栏的 **“报餐”**。
* 系统会列出未来几天的排餐计划。
* 点击蓝色 **“报餐”** 按钮，系统自动扣除余额并生成订单。
* **注意**：如果不显示任何内容，说明管理员还没有发布排餐计划。

### 3. 退餐/取消
* 如果您临时有事无法就餐，请点击红色 **“退餐”** 按钮，费用将自动退回余额。
* **截止时间限制**：系统设有每日截止时间（如上午 10:30）。超过此时间后，为了避免食堂食材浪费，系统将**禁止退餐**。

### 4. 个人中心
* **查看余额**：在“我的”页面顶部查看当前剩余金额。
* **消费记录**：查看所有的报餐和退款明细。
* **修改资料**：可以修改姓名、手机号（账号）和登录密码。
* **问题反馈**：向管理员提交意见或建议。

---

## 🛡️ 管理手册 (管理员/财务篇)

管理员登录后，首页会显示 **“餐厅管理”** 九宫格工作台。操作顺序建议如下：

### 第一步：基础设置
1.  **🏷️ 身份价格**：
    * 进入此模块，设置不同人员的餐费标准。
    * 支持动态添加身份（如：专线人员、实习生、访客），并分别设定价格。
2.  **⏰ 报餐管理**：
    * 设置每日报餐/退餐的 **截止时间**（默认为 10:30）。

### 第二步：人员管理
1.  **👥 人员管理**：
    * **审核**：新注册用户会显示在“待审核”列表中，点击“通过”即可允许其登录。
    * **赋权**：点击“权限”，可以将某个用户提拔为“财务人员”或“管理员”。
    * **编辑**：如果员工填错了信息，管理员可以代为修改。

### 第三步：财务充值 (财务人员可用)
1.  **💰 财务管理**：
    * 输入员工手机号进行搜索。
    * 确认姓名无误后，输入充值金额。
    * 点击确认，资金实时到账，下方会显示该用户的历史充值记录。

### 第四步：日常排餐 (核心)
1.  **📅 排餐管理**：
    * **这是系统运转的发动机**。没有排餐，用户无法报餐。
    * 选择开始日期和结束日期（例如：本周一到本周五）。
    * 点击提交，系统批量生成可报餐日期。

### 第五步：数据查看与发布
1.  **📢 公告发布**：编辑首页顶部滚动的通知内容，支持设置对齐方式（居左/居中/居右）。
2.  **📊 报餐统计**：
    * **食堂每日必看**。查看今天有多少人吃饭，共收了多少钱，以便准备食材。
    * 支持按日期筛选查询历史数据。
3.  **📈 统计分析**：
    * 查看营业收入曲线（按日/按月）。
    * 查看资金池总额（所有用户余额之和）。
4.  **📝 问题反馈**：查看用户提交的反馈意见。

---

## ❓ 常见问题 (FAQ)

**Q: 为什么我修改了代码，页面上没变化？**
A: 浏览器通常会缓存 JS 和 CSS 文件。请尝试强制刷新（Ctrl+F5），或在手机设置中清除浏览器缓存。

**Q: 报餐时提示“数据库被锁定 (database is locked)”？**
A: 这是 SQLite 的特性，通常发生在写入权限不足或并发极高时。请重点检查服务器上 `/data` 目录是否赋予了 **777 (读写执行)** 权限。

**Q: 如何备份数据？**
A: 非常简单！只需要下载服务器上的 `/data/meal.db` 文件保存到本地即可。恢复时，将文件上传覆盖回去。

**Q: 忘记管理员密码怎么办？**
A: 由于系统没有邮件服务器，无法自助找回。
* **方法一**：如果有其他管理员账号，登录后在“人员管理”中重置。
* **方法二**：如果只有一个管理员且忘了，需要下载 `meal.db` 使用 SQLite 软件打开，手动修改 `users` 表中的 password 字段（需要生成一个新的 bcrypt哈希值）。或者简单粗暴地删除 `.db` 文件，重新运行 `install.php`（**注意：这会清空所有数据！**）。

---

## 📂 项目结构简述

* `/api`: 后端接口逻辑
* `/core`: 核心类库 (数据库连接、权限验证)
* `/data`: 存放 SQLite 数据库文件
* `/public`: 前端页面资源 (HTML/CSS/JS)
* `DEVELOPMENT.md`: 详细的技术开发文档

---

## ❤️ 致谢与版权

* **开发者**：Gemini
* **技术栈**：Native PHP + SQLite + Vanilla JS
* **版权声明**：本项目开源，供学习与企业内部使用。

> 如果您觉得这个系统对您有帮助，请保留页面底部的开发者标识，谢谢！